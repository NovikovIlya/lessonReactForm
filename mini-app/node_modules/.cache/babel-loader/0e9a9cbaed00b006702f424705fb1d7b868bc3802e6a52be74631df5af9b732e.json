{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"action\", \"shown\", \"showDelay\", \"hideDelay\", \"offsetDistance\", \"content\", \"children\", \"style\", \"className\", \"getRef\", \"onShownChange\"];\nimport * as React from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '@vkontakte/vkjs';\nimport { Popper } from '../Popper/Popper';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useEventListener } from '../../hooks/useEventListener';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { usePatchChildrenRef } from '../../hooks/usePatchChildrenRef';\n/**\n * @see https://vkcom.github.io/VKUI/#/Popover\n */\nexport var Popover = function Popover(_ref) {\n  var _ref$action = _ref.action,\n    action = _ref$action === void 0 ? 'click' : _ref$action,\n    shownProp = _ref.shown,\n    _ref$showDelay = _ref.showDelay,\n    showDelay = _ref$showDelay === void 0 ? 150 : _ref$showDelay,\n    _ref$hideDelay = _ref.hideDelay,\n    hideDelay = _ref$hideDelay === void 0 ? 150 : _ref$hideDelay,\n    _ref$offsetDistance = _ref.offsetDistance,\n    offsetDistance = _ref$offsetDistance === void 0 ? 8 : _ref$offsetDistance,\n    content = _ref.content,\n    children = _ref.children,\n    styleProp = _ref.style,\n    className = _ref.className,\n    getRef = _ref.getRef,\n    onShownChange = _ref.onShownChange,\n    restProps = _objectWithoutProperties(_ref, _excluded);\n  var _useDOM = useDOM(),\n    document = _useDOM.document;\n  var hoverable = action === 'hover';\n  var hovered = React.useRef(false);\n  var _React$useState = React.useState(shownProp || false),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    computedShown = _React$useState2[0],\n    setComputedShown = _React$useState2[1];\n  var _React$useState3 = React.useState(null),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    dropdownNode = _React$useState4[0],\n    setPopperNode = _React$useState4[1];\n  var shown = typeof shownProp === 'boolean' ? shownProp : computedShown;\n  var patchedPopperRef = useExternRef(setPopperNode, getRef);\n  var _usePatchChildrenRef = usePatchChildrenRef(children),\n    _usePatchChildrenRef2 = _slicedToArray(_usePatchChildrenRef, 2),\n    childRef = _usePatchChildrenRef2[0],\n    child = _usePatchChildrenRef2[1];\n  var setShown = function setShown(value) {\n    if (typeof shownProp !== 'boolean') {\n      setComputedShown(value);\n    }\n    typeof onShownChange === 'function' && onShownChange(value);\n  };\n  var showTimeout = useTimeout(function () {\n    return setShown(true);\n  }, showDelay);\n  var hideTimeout = useTimeout(function () {\n    return setShown(false);\n  }, hideDelay);\n  var handleTargetEnter = function handleTargetEnter() {\n    hovered.current = true;\n    hideTimeout.clear();\n    showTimeout.set();\n  };\n  var handleTargetClick = function handleTargetClick() {\n    if (hovered.current && shown) {\n      return;\n    }\n    setShown(!shown);\n  };\n  var handleTargetLeave = function handleTargetLeave() {\n    hovered.current = false;\n    showTimeout.clear();\n    hideTimeout.set();\n  };\n  var handleContentKeyDownEscape = function handleContentKeyDownEscape() {\n    setShown(false);\n  };\n  var handleOutsideClick = function handleOutsideClick(e) {\n    var _childRef$current;\n    if (dropdownNode && !((_childRef$current = childRef.current) !== null && _childRef$current !== void 0 && _childRef$current.contains(e.target)) && !dropdownNode.contains(e.target)) {\n      setShown(false);\n    }\n  };\n  useGlobalEventListener(document, 'click', handleOutsideClick);\n  var targetEnterListener = useEventListener('mouseenter', handleTargetEnter);\n  var targetClickEvent = useEventListener('click', handleTargetClick);\n  var targetLeaveListener = useEventListener('mouseleave', handleTargetLeave);\n  React.useEffect(function () {\n    if (!childRef.current) {\n      return;\n    }\n    targetClickEvent.add(childRef.current);\n  }, [childRef, targetClickEvent]);\n  React.useEffect(function () {\n    if (!childRef.current) {\n      return;\n    }\n    if (hoverable) {\n      targetEnterListener.add(childRef.current);\n      targetLeaveListener.add(childRef.current);\n    }\n    return function () {\n      targetEnterListener.remove();\n      targetLeaveListener.remove();\n    };\n  }, [childRef, hoverable, targetEnterListener, targetLeaveListener]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, child, shown && /*#__PURE__*/React.createElement(Popper, _extends({}, restProps, {\n    className: classNames(\"vkuiPopover\", className),\n    targetRef: childRef,\n    getRef: patchedPopperRef,\n    offsetDistance: offsetDistance,\n    style:\n    // Reason: Typescript ругается на CSS Custom Properties в объекте\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    _objectSpread(_objectSpread({}, styleProp), {}, {\n      '--vkui_internal--popover_safe_zone_padding': \"\".concat(offsetDistance, \"px\")\n    }),\n    renderContent: function renderContent(_ref2) {\n      var wrapperClassName = _ref2.className;\n      return /*#__PURE__*/React.createElement(FocusTrap, {\n        className: wrapperClassName,\n        onClose: handleContentKeyDownEscape\n      }, content);\n    },\n    onMouseOver: hoverable ? hideTimeout.clear : undefined,\n    onMouseOut: hoverable ? handleTargetLeave : undefined\n  })));\n};","map":{"version":3,"names":["React","useDOM","classNames","Popper","FocusTrap","useTimeout","useExternRef","useEventListener","useGlobalEventListener","usePatchChildrenRef","Popover","_ref","_ref$action","action","shownProp","shown","_ref$showDelay","showDelay","_ref$hideDelay","hideDelay","_ref$offsetDistance","offsetDistance","content","children","styleProp","style","className","getRef","onShownChange","restProps","_objectWithoutProperties","_excluded","_useDOM","document","hoverable","hovered","useRef","_React$useState","useState","_React$useState2","_slicedToArray","computedShown","setComputedShown","_React$useState3","_React$useState4","dropdownNode","setPopperNode","patchedPopperRef","_usePatchChildrenRef","_usePatchChildrenRef2","childRef","child","setShown","value","showTimeout","hideTimeout","handleTargetEnter","current","clear","set","handleTargetClick","handleTargetLeave","handleContentKeyDownEscape","handleOutsideClick","e","_childRef$current","contains","target","targetEnterListener","targetClickEvent","targetLeaveListener","useEffect","add","remove","createElement","Fragment","_extends","targetRef","_objectSpread","concat","renderContent","_ref2","wrapperClassName","onClose","onMouseOver","undefined","onMouseOut"],"sources":["E:\\lessonReactForm\\mini-app\\node_modules\\@vkontakte\\vkui\\src\\components\\Popover\\Popover.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '@vkontakte/vkjs';\nimport { PopperCommonProps, Popper } from '../Popper/Popper';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useEventListener } from '../../hooks/useEventListener';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { usePatchChildrenRef } from '../../hooks/usePatchChildrenRef';\nimport styles from './Popover.module.css';\n\nexport interface PopoverProps extends Omit<PopperCommonProps, 'arrow' | 'arrowClassName'> {\n  /**\n   * Механика вызова всплывающего окна.\n   *\n   * - `\"click\"` – показывается/скрывается только при нажатии.\n   * - `\"hover\"` – помимо нажатия, будет показываться/скрывается при наведении/отведении мыши.\n   *\n   * > ⚠️`\"hover\"` на тач-устройствах будет работать как `\"click\"`, с одним лишь нюансом, что не будет закрываться\n   * > при повторном нажатии на целевой элемент. Для закрытия необходимо нажать на область вне целевого элемента\n   * > и выпадающего окна.\n   */\n  action?: 'click' | 'hover';\n  /**\n   * Если передан, то всплывающее окно будет показан/скрыт в зависимости от значения свойства.\n   */\n  shown?: boolean;\n  /**\n   * Количество миллисекунд, после которых произойдёт показ всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  showDelay?: number;\n  /**\n   * Количество миллисекунд, после которых произойдёт скрытие всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  hideDelay?: number;\n  /**\n   * Содержимое всплывающего окна.\n   */\n  content?: React.ReactNode;\n  /**\n   * Целевой элемент. Всплывающее окно появится возле него.\n   *\n   * > ⚠️ Если это пользовательский компонент, то он должен предоставлять параметры либо `getRootRef`, либо `ref` для получения ссылки на DOM-узел.\n   */\n  children?: React.ReactElement;\n  /**\n   * Вызывается при каждом изменении видимости всплывающего окна.\n   */\n  onShownChange?(shown: boolean): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Popover\n */\nexport const Popover = ({\n  action = 'click',\n  shown: shownProp,\n  showDelay = 150,\n  hideDelay = 150,\n  offsetDistance = 8,\n  content,\n  children,\n  style: styleProp,\n  className,\n  getRef,\n  onShownChange,\n  ...restProps\n}: PopoverProps) => {\n  const { document } = useDOM();\n\n  const hoverable = action === 'hover';\n  const hovered = React.useRef(false);\n  const [computedShown, setComputedShown] = React.useState(shownProp || false);\n  const [dropdownNode, setPopperNode] = React.useState<HTMLElement | null>(null);\n\n  const shown = typeof shownProp === 'boolean' ? shownProp : computedShown;\n\n  const patchedPopperRef = useExternRef<HTMLDivElement>(setPopperNode, getRef);\n\n  const [childRef, child] = usePatchChildrenRef(children);\n\n  const setShown = (value: boolean) => {\n    if (typeof shownProp !== 'boolean') {\n      setComputedShown(value);\n    }\n    typeof onShownChange === 'function' && onShownChange(value);\n  };\n\n  const showTimeout = useTimeout(() => setShown(true), showDelay);\n\n  const hideTimeout = useTimeout(() => setShown(false), hideDelay);\n\n  const handleTargetEnter = () => {\n    hovered.current = true;\n    hideTimeout.clear();\n    showTimeout.set();\n  };\n\n  const handleTargetClick = () => {\n    if (hovered.current && shown) {\n      return;\n    }\n    setShown(!shown);\n  };\n\n  const handleTargetLeave = () => {\n    hovered.current = false;\n    showTimeout.clear();\n    hideTimeout.set();\n  };\n\n  const handleContentKeyDownEscape = () => {\n    setShown(false);\n  };\n\n  const handleOutsideClick = (e: MouseEvent) => {\n    if (\n      dropdownNode &&\n      !childRef.current?.contains(e.target as Node) &&\n      !dropdownNode.contains(e.target as Node)\n    ) {\n      setShown(false);\n    }\n  };\n\n  useGlobalEventListener(document, 'click', handleOutsideClick);\n  const targetEnterListener = useEventListener('mouseenter', handleTargetEnter);\n  const targetClickEvent = useEventListener('click', handleTargetClick);\n  const targetLeaveListener = useEventListener('mouseleave', handleTargetLeave);\n\n  React.useEffect(() => {\n    if (!childRef.current) {\n      return;\n    }\n\n    targetClickEvent.add(childRef.current);\n  }, [childRef, targetClickEvent]);\n\n  React.useEffect(() => {\n    if (!childRef.current) {\n      return;\n    }\n\n    if (hoverable) {\n      targetEnterListener.add(childRef.current);\n      targetLeaveListener.add(childRef.current);\n    }\n\n    return () => {\n      targetEnterListener.remove();\n      targetLeaveListener.remove();\n    };\n  }, [childRef, hoverable, targetEnterListener, targetLeaveListener]);\n\n  return (\n    <React.Fragment>\n      {child}\n      {shown && (\n        <Popper\n          {...restProps}\n          className={classNames(styles['Popover'], className)}\n          targetRef={childRef}\n          getRef={patchedPopperRef}\n          offsetDistance={offsetDistance}\n          style={\n            // Reason: Typescript ругается на CSS Custom Properties в объекте\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            {\n              ...styleProp,\n              '--vkui_internal--popover_safe_zone_padding': `${offsetDistance}px`,\n            } as React.CSSProperties\n          }\n          renderContent={({ className: wrapperClassName }) => (\n            <FocusTrap className={wrapperClassName} onClose={handleContentKeyDownEscape}>\n              {content}\n            </FocusTrap>\n          )}\n          onMouseOver={hoverable ? hideTimeout.clear : undefined}\n          onMouseOut={hoverable ? handleTargetLeave : undefined}\n        />\n      )}\n    </React.Fragment>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
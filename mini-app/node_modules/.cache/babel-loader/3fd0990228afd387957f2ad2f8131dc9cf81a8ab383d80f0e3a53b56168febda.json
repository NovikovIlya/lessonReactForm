{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _createForOfIteratorHelper from \"@babel/runtime/helpers/createForOfIteratorHelper\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"children\", \"targetRef\", \"scrollBoxRef\", \"placement\", \"fetching\", \"onPlacementChange\", \"offsetDistance\", \"sameWidth\", \"forcePortal\", \"autoHideScrollbar\", \"autoHideScrollbarDelay\", \"observableRefs\", \"className\"];\nimport * as React from 'react';\nimport { CustomScrollView } from '../CustomScrollView/CustomScrollView';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { Popper } from '../Popper/Popper';\nimport { Spinner } from '../Spinner/Spinner';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nvar calcIsTop = function calcIsTop(placement) {\n  return placement === null || placement === void 0 ? void 0 : placement.includes('top');\n};\nfunction getObserverModifier(element) {\n  return {\n    name: 'customSelectChildrenChange',\n    enabled: true,\n    phase: 'main',\n    fn: noop,\n    effect: function effect(_ref) {\n      var instance = _ref.instance;\n      var observer = new MutationObserver(instance.forceUpdate);\n      observer.observe(element, {\n        childList: true,\n        subtree: true\n      });\n      return function () {\n        observer.disconnect();\n      };\n    }\n  };\n}\nexport var CustomSelectDropdown = function CustomSelectDropdown(_ref2) {\n  var children = _ref2.children,\n    targetRef = _ref2.targetRef,\n    scrollBoxRef = _ref2.scrollBoxRef,\n    placement = _ref2.placement,\n    fetching = _ref2.fetching,\n    parentOnPlacementChange = _ref2.onPlacementChange,\n    _ref2$offsetDistance = _ref2.offsetDistance,\n    offsetDistance = _ref2$offsetDistance === void 0 ? 0 : _ref2$offsetDistance,\n    _ref2$sameWidth = _ref2.sameWidth,\n    sameWidth = _ref2$sameWidth === void 0 ? true : _ref2$sameWidth,\n    _ref2$forcePortal = _ref2.forcePortal,\n    forcePortal = _ref2$forcePortal === void 0 ? true : _ref2$forcePortal,\n    autoHideScrollbar = _ref2.autoHideScrollbar,\n    autoHideScrollbarDelay = _ref2.autoHideScrollbarDelay,\n    observableRefs = _ref2.observableRefs,\n    className = _ref2.className,\n    restProps = _objectWithoutProperties(_ref2, _excluded);\n  var _React$useState = React.useState(function () {\n      return calcIsTop(placement);\n    }),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    isTop = _React$useState2[0],\n    setIsTop = _React$useState2[1];\n  var _React$useState3 = React.useState([]),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    customModifiers = _React$useState4[0],\n    setCustomModifiers = _React$useState4[1];\n  useIsomorphicLayoutEffect(function () {\n    if (!observableRefs) {\n      return;\n    }\n    var customModifiers = [];\n    if (Array.isArray(observableRefs)) {\n      var _iterator = _createForOfIteratorHelper(observableRefs),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var ref = _step.value;\n          if (ref !== null && ref !== void 0 && ref.current) {\n            customModifiers.push(getObserverModifier(ref.current));\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    } else if (observableRefs.current) {\n      customModifiers.push(getObserverModifier(observableRefs.current));\n    }\n    setCustomModifiers(customModifiers);\n  }, [observableRefs]);\n  var onPlacementChange = React.useCallback(function (_ref3) {\n    var placement = _ref3.placement;\n    setIsTop(calcIsTop(placement));\n    parentOnPlacementChange === null || parentOnPlacementChange === void 0 ? void 0 : parentOnPlacementChange(placement);\n  }, [parentOnPlacementChange, setIsTop]);\n  return /*#__PURE__*/React.createElement(Popper, _extends({\n    targetRef: targetRef,\n    offsetDistance: offsetDistance,\n    sameWidth: sameWidth,\n    onPlacementChange: onPlacementChange,\n    placement: placement,\n    className: classNames(\"vkuiCustomSelectDropdown\", offsetDistance === 0 && (isTop ? \"vkuiCustomSelectDropdown--top\" : \"vkuiCustomSelectDropdown--bottom\"), sameWidth && \"vkuiCustomSelectDropdown--wide\", className),\n    forcePortal: forcePortal,\n    customModifiers: customModifiers\n  }, restProps), /*#__PURE__*/React.createElement(CustomScrollView, {\n    boxRef: scrollBoxRef,\n    className: \"vkuiCustomSelectDropdown__in\",\n    autoHideScrollbar: autoHideScrollbar,\n    autoHideScrollbarDelay: autoHideScrollbarDelay\n  }, fetching ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiCustomSelectDropdown__fetching\"\n  }, /*#__PURE__*/React.createElement(Spinner, {\n    size: \"small\"\n  })) : children));\n};","map":{"version":3,"names":["React","CustomScrollView","classNames","noop","Popper","Spinner","useIsomorphicLayoutEffect","calcIsTop","placement","includes","getObserverModifier","element","name","enabled","phase","fn","effect","_ref","instance","observer","MutationObserver","forceUpdate","observe","childList","subtree","disconnect","CustomSelectDropdown","_ref2","children","targetRef","scrollBoxRef","fetching","parentOnPlacementChange","onPlacementChange","_ref2$offsetDistance","offsetDistance","_ref2$sameWidth","sameWidth","_ref2$forcePortal","forcePortal","autoHideScrollbar","autoHideScrollbarDelay","observableRefs","className","restProps","_objectWithoutProperties","_excluded","_React$useState","useState","_React$useState2","_slicedToArray","isTop","setIsTop","_React$useState3","_React$useState4","customModifiers","setCustomModifiers","Array","isArray","_iterator","_createForOfIteratorHelper","_step","s","n","done","ref","value","current","push","err","e","f","useCallback","_ref3","createElement","_extends","boxRef","size"],"sources":["E:\\lessonReactForm\\mini-app\\node_modules\\@vkontakte\\vkui\\src\\components\\CustomSelectDropdown\\CustomSelectDropdown.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Modifier } from 'react-popper';\nimport { CustomScrollView } from '../CustomScrollView/CustomScrollView';\nimport { TrackerOptionsProps } from '../CustomScrollView/useTrackerVisibility';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { Popper, Placement } from '../Popper/Popper';\nimport { Spinner } from '../Spinner/Spinner';\nimport { HasRef } from '../../types';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport styles from './CustomSelectDropdown.module.css';\n\nexport interface CustomSelectDropdownProps\n  extends React.HTMLAttributes<HTMLElement>,\n    HasRef<HTMLDivElement>,\n    TrackerOptionsProps {\n  targetRef: React.RefObject<HTMLElement>;\n  placement?: Placement;\n  scrollBoxRef?: React.Ref<HTMLDivElement>;\n  observableRefs?: Array<React.RefObject<HTMLElement>> | React.RefObject<HTMLElement>;\n  fetching?: boolean;\n  offsetDistance?: number;\n  sameWidth?: boolean;\n  forcePortal?: boolean;\n  onPlacementChange?: (placement?: Placement) => void;\n}\n\nconst calcIsTop = (placement?: Placement) => placement?.includes('top');\n\nfunction getObserverModifier<T extends HTMLElement>(element: T): Modifier<string> {\n  return {\n    name: 'customSelectChildrenChange',\n    enabled: true,\n    phase: 'main',\n    fn: noop,\n    effect: ({ instance }) => {\n      const observer = new MutationObserver(instance.forceUpdate);\n\n      observer.observe(element, {\n        childList: true,\n        subtree: true,\n      });\n\n      return () => {\n        observer.disconnect();\n      };\n    },\n  };\n}\n\nexport const CustomSelectDropdown = ({\n  children,\n  targetRef,\n  scrollBoxRef,\n  placement,\n  fetching,\n  onPlacementChange: parentOnPlacementChange,\n  offsetDistance = 0,\n  sameWidth = true,\n  forcePortal = true,\n  autoHideScrollbar,\n  autoHideScrollbarDelay,\n  observableRefs,\n  className,\n  ...restProps\n}: CustomSelectDropdownProps) => {\n  const [isTop, setIsTop] = React.useState(() => calcIsTop(placement));\n  const [customModifiers, setCustomModifiers] = React.useState<Array<Modifier<string>>>([]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!observableRefs) {\n      return;\n    }\n    const customModifiers: Array<Modifier<string>> = [];\n\n    if (Array.isArray(observableRefs)) {\n      for (const ref of observableRefs) {\n        if (ref?.current) {\n          customModifiers.push(getObserverModifier(ref.current));\n        }\n      }\n    } else if (observableRefs.current) {\n      customModifiers.push(getObserverModifier(observableRefs.current));\n    }\n\n    setCustomModifiers(customModifiers);\n  }, [observableRefs]);\n\n  const onPlacementChange = React.useCallback(\n    ({ placement }: { placement?: Placement }) => {\n      setIsTop(calcIsTop(placement));\n      parentOnPlacementChange?.(placement);\n    },\n    [parentOnPlacementChange, setIsTop],\n  );\n\n  return (\n    <Popper\n      targetRef={targetRef}\n      offsetDistance={offsetDistance}\n      sameWidth={sameWidth}\n      onPlacementChange={onPlacementChange}\n      placement={placement}\n      className={classNames(\n        styles['CustomSelectDropdown'],\n        offsetDistance === 0 &&\n          (isTop ? styles['CustomSelectDropdown--top'] : styles['CustomSelectDropdown--bottom']),\n        sameWidth && styles['CustomSelectDropdown--wide'],\n        className,\n      )}\n      forcePortal={forcePortal}\n      customModifiers={customModifiers}\n      {...restProps}\n    >\n      <CustomScrollView\n        boxRef={scrollBoxRef}\n        className={styles['CustomSelectDropdown__in']}\n        autoHideScrollbar={autoHideScrollbar}\n        autoHideScrollbarDelay={autoHideScrollbarDelay}\n      >\n        {fetching ? (\n          <div className={styles['CustomSelectDropdown__fetching']}>\n            <Spinner size=\"small\" />\n          </div>\n        ) : (\n          children\n        )}\n      </CustomScrollView>\n    </Popper>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"Component\", \"onClose\", \"restoreFocus\", \"timeout\", \"getRootRef\", \"children\"];\nimport * as React from 'react';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { FOCUSABLE_ELEMENTS_LIST, Keys, pressedKey } from '../../lib/accessibility';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { AppRootContext } from '../AppRoot/AppRootContext';\nvar FOCUSABLE_ELEMENTS = FOCUSABLE_ELEMENTS_LIST.join();\n/**\n * @see https://vkcom.github.io/VKUI/#/FocusTrap\n */\nexport var FocusTrap = function FocusTrap(_ref) {\n  var _ref$Component = _ref.Component,\n    Component = _ref$Component === void 0 ? 'div' : _ref$Component,\n    onClose = _ref.onClose,\n    _ref$restoreFocus = _ref.restoreFocus,\n    restoreFocus = _ref$restoreFocus === void 0 ? true : _ref$restoreFocus,\n    _ref$timeout = _ref.timeout,\n    timeout = _ref$timeout === void 0 ? 0 : _ref$timeout,\n    getRootRef = _ref.getRootRef,\n    children = _ref.children,\n    restProps = _objectWithoutProperties(_ref, _excluded);\n  var ref = useExternRef(getRootRef);\n  var _useDOM = useDOM(),\n    document = _useDOM.document,\n    window = _useDOM.window;\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    focusableNodes = _React$useState2[0],\n    setFocusableNodes = _React$useState2[1];\n  var _React$useState3 = React.useState(null),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    restoreFocusTo = _React$useState4[0],\n    setRestoreFocusTo = _React$useState4[1];\n\n  // HANDLE TRAP MOUNT\n\n  var _React$useContext = React.useContext(AppRootContext),\n    keyboardInput = _React$useContext.keyboardInput;\n  var focusOnTrapMount = useTimeout(function () {\n    var _ref$current;\n    if (keyboardInput && !((_ref$current = ref.current) !== null && _ref$current !== void 0 && _ref$current.contains(document.activeElement)) && focusableNodes !== null && focusableNodes !== void 0 && focusableNodes.length) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    focusOnTrapMount.set();\n  }, []);\n\n  // HANDLE FOCUSABLE NODES\n\n  useIsomorphicLayoutEffect(function () {\n    if (!ref.current) {\n      return;\n    }\n    var nodes = [];\n    Array.prototype.forEach.call(\n    // eslint-disable-next-line no-restricted-properties\n    ref.current.querySelectorAll(FOCUSABLE_ELEMENTS), function (focusableEl) {\n      var _getComputedStyle = window.getComputedStyle(focusableEl),\n        display = _getComputedStyle.display,\n        visibility = _getComputedStyle.visibility;\n      if (display !== 'none' && visibility !== 'hidden') {\n        nodes.push(focusableEl);\n      }\n    });\n    if (nodes.length === 0) {\n      // Чтобы фокус был хотя бы на родителе\n      nodes.push(ref.current);\n    }\n    setFocusableNodes(nodes);\n  }, [children]);\n\n  // HANDLE TRAP UNMOUNT\n\n  var focusOnTrapUnmount = useTimeout(function () {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(function () {\n    if (restoreFocus && document.activeElement) {\n      setRestoreFocusTo(document.activeElement);\n      return function () {\n        focusOnTrapUnmount.set();\n      };\n    }\n    return;\n  }, [restoreFocus]);\n  var onDocumentKeydown = function onDocumentKeydown(e) {\n    if (pressedKey(e) === Keys.TAB && focusableNodes !== null && focusableNodes !== void 0 && focusableNodes.length) {\n      var lastIdx = focusableNodes.length - 1;\n      var targetIdx = focusableNodes.findIndex(function (node) {\n        return node === e.target;\n      });\n      var shouldFocusFirstNode = targetIdx === -1 || targetIdx === lastIdx && !e.shiftKey;\n      if (shouldFocusFirstNode || targetIdx === 0 && e.shiftKey) {\n        e.preventDefault();\n        var node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n        if (node !== document.activeElement) {\n          node.focus();\n        }\n        return false;\n      }\n    }\n    if (onClose && pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n    return true;\n  };\n  useGlobalEventListener(document, 'keydown', onDocumentKeydown, {\n    capture: true\n  });\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    tabIndex: -1,\n    ref: ref\n  }, restProps), children);\n};","map":{"version":3,"names":["React","useExternRef","useGlobalEventListener","useTimeout","FOCUSABLE_ELEMENTS_LIST","Keys","pressedKey","useDOM","useIsomorphicLayoutEffect","AppRootContext","FOCUSABLE_ELEMENTS","join","FocusTrap","_ref","_ref$Component","Component","onClose","_ref$restoreFocus","restoreFocus","_ref$timeout","timeout","getRootRef","children","restProps","_objectWithoutProperties","_excluded","ref","_useDOM","document","window","_React$useState","useState","_React$useState2","_slicedToArray","focusableNodes","setFocusableNodes","_React$useState3","_React$useState4","restoreFocusTo","setRestoreFocusTo","_React$useContext","useContext","keyboardInput","focusOnTrapMount","_ref$current","current","contains","activeElement","length","focus","set","nodes","Array","prototype","forEach","call","querySelectorAll","focusableEl","_getComputedStyle","getComputedStyle","display","visibility","push","focusOnTrapUnmount","onDocumentKeydown","e","TAB","lastIdx","targetIdx","findIndex","node","target","shouldFocusFirstNode","shiftKey","preventDefault","ESCAPE","capture","createElement","_extends","tabIndex"],"sources":["E:\\lessonReactForm\\mini-app\\node_modules\\@vkontakte\\vkui\\src\\components\\FocusTrap\\FocusTrap.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { FOCUSABLE_ELEMENTS_LIST, Keys, pressedKey } from '../../lib/accessibility';\nimport { useDOM } from '../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { HasComponent, HasRootRef } from '../../types';\nimport { AppRootContext } from '../AppRoot/AppRootContext';\n\nconst FOCUSABLE_ELEMENTS: string = FOCUSABLE_ELEMENTS_LIST.join();\nexport interface FocusTrapProps\n  extends React.AllHTMLAttributes<HTMLElement>,\n    HasRootRef<HTMLElement>,\n    HasComponent {\n  restoreFocus?: boolean;\n  timeout?: number;\n  onClose?(): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/FocusTrap\n */\nexport const FocusTrap = ({\n  Component = 'div',\n  onClose,\n  restoreFocus = true,\n  timeout = 0,\n  getRootRef,\n  children,\n  ...restProps\n}: FocusTrapProps) => {\n  const ref = useExternRef<HTMLElement>(getRootRef);\n\n  const { document, window } = useDOM();\n\n  const [focusableNodes, setFocusableNodes] = React.useState<HTMLElement[] | null>(null);\n  const [restoreFocusTo, setRestoreFocusTo] = React.useState<HTMLElement | null>(null);\n\n  // HANDLE TRAP MOUNT\n\n  const { keyboardInput } = React.useContext(AppRootContext);\n  const focusOnTrapMount = useTimeout(() => {\n    if (\n      keyboardInput &&\n      !ref.current?.contains(document!.activeElement) &&\n      focusableNodes?.length\n    ) {\n      focusableNodes[0].focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    focusOnTrapMount.set();\n  }, []);\n\n  // HANDLE FOCUSABLE NODES\n\n  useIsomorphicLayoutEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    const nodes: HTMLElement[] = [];\n    Array.prototype.forEach.call(\n      // eslint-disable-next-line no-restricted-properties\n      ref.current.querySelectorAll(FOCUSABLE_ELEMENTS),\n      (focusableEl: Element) => {\n        const { display, visibility } = window!.getComputedStyle(focusableEl);\n\n        if (display !== 'none' && visibility !== 'hidden') {\n          nodes.push(focusableEl as HTMLElement);\n        }\n      },\n    );\n\n    if (nodes.length === 0) {\n      // Чтобы фокус был хотя бы на родителе\n      nodes.push(ref.current);\n    }\n\n    setFocusableNodes(nodes);\n  }, [children]);\n\n  // HANDLE TRAP UNMOUNT\n\n  const focusOnTrapUnmount = useTimeout(() => {\n    if (restoreFocusTo) {\n      restoreFocusTo.focus();\n    }\n  }, timeout);\n  useIsomorphicLayoutEffect(() => {\n    if (restoreFocus && document!.activeElement) {\n      setRestoreFocusTo(document!.activeElement as HTMLElement);\n\n      return () => {\n        focusOnTrapUnmount.set();\n      };\n    }\n\n    return;\n  }, [restoreFocus]);\n\n  const onDocumentKeydown = (e: KeyboardEvent) => {\n    if (pressedKey(e) === Keys.TAB && focusableNodes?.length) {\n      const lastIdx = focusableNodes.length - 1;\n      const targetIdx = focusableNodes.findIndex((node) => node === e.target);\n\n      const shouldFocusFirstNode = targetIdx === -1 || (targetIdx === lastIdx && !e.shiftKey);\n\n      if (shouldFocusFirstNode || (targetIdx === 0 && e.shiftKey)) {\n        e.preventDefault();\n\n        const node = focusableNodes[shouldFocusFirstNode ? 0 : lastIdx];\n\n        if (node !== document!.activeElement) {\n          node.focus();\n        }\n\n        return false;\n      }\n    }\n\n    if (onClose && pressedKey(e) === Keys.ESCAPE) {\n      onClose();\n    }\n\n    return true;\n  };\n  useGlobalEventListener(document, 'keydown', onDocumentKeydown, {\n    capture: true,\n  });\n\n  return (\n    <Component tabIndex={-1} ref={ref} {...restProps}>\n      {children}\n    </Component>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from 'react';\nexport var useDraggable = function useDraggable(_ref) {\n  var rootElRef = _ref.rootElRef,\n    onDragFinish = _ref.onDragFinish;\n  var _React$useState = React.useState(false),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    dragging = _React$useState2[0],\n    setDragging = _React$useState2[1];\n  var _React$useState3 = React.useState([]),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    siblings = _React$useState4[0],\n    setSiblings = _React$useState4[1];\n  var _React$useState5 = React.useState(0),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    dragStartIndex = _React$useState6[0],\n    setDragStartIndex = _React$useState6[1];\n  var _React$useState7 = React.useState(0),\n    _React$useState8 = _slicedToArray(_React$useState7, 2),\n    dragEndIndex = _React$useState8[0],\n    setDragEndIndex = _React$useState8[1];\n  var _React$useState9 = React.useState(0),\n    _React$useState10 = _slicedToArray(_React$useState9, 2),\n    dragShift = _React$useState10[0],\n    setDragShift = _React$useState10[1];\n  var _React$useState11 = React.useState(undefined),\n    _React$useState12 = _slicedToArray(_React$useState11, 2),\n    dragDirection = _React$useState12[0],\n    setDragDirection = _React$useState12[1];\n  var onDragStart = function onDragStart() {\n    var _rootEl$parentElement;\n    var rootEl = rootElRef.current;\n    if (!rootEl) {\n      return;\n    }\n    setDragging(true);\n    var _siblings = [];\n    if ((_rootEl$parentElement = rootEl.parentElement) !== null && _rootEl$parentElement !== void 0 && _rootEl$parentElement.childNodes) {\n      _siblings = Array.from(rootEl.parentElement.children);\n    }\n    var idx = _siblings.indexOf(rootEl);\n    setDragStartIndex(idx);\n    setDragEndIndex(idx);\n    setSiblings(_siblings);\n    setDragShift(0);\n  };\n  var onDragMove = function onDragMove(e) {\n    e.originalEvent.preventDefault();\n    var rootEl = rootElRef.current;\n    if (rootEl) {\n      rootEl.style.transform = \"translateY(\".concat(e.shiftY, \"px)\");\n      var rootGesture = rootEl.getBoundingClientRect();\n      setDragDirection(dragShift - e.shiftY < 0 ? 'down' : 'up');\n      setDragShift(e.shiftY);\n      setDragEndIndex(dragStartIndex);\n      siblings.forEach(function (sibling, siblingIndex) {\n        var siblingGesture = sibling.getBoundingClientRect();\n        var siblingHalfHeight = siblingGesture.height / 2;\n        var rootOverSibling = rootGesture.bottom > siblingGesture.top + siblingHalfHeight;\n        var rootUnderSibling = rootGesture.top < siblingGesture.bottom - siblingHalfHeight;\n        if (dragStartIndex < siblingIndex) {\n          if (rootOverSibling) {\n            if (dragDirection === 'down') {\n              sibling.style.transform = 'translateY(-100%)';\n            }\n            setDragEndIndex(function (dragEndIndex) {\n              return dragEndIndex + 1;\n            });\n          }\n          if (rootUnderSibling && dragDirection === 'up') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        } else if (dragStartIndex > siblingIndex) {\n          if (rootUnderSibling) {\n            if (dragDirection === 'up') {\n              sibling.style.transform = 'translateY(100%)';\n            }\n            setDragEndIndex(function (dragEndIndex) {\n              return dragEndIndex - 1;\n            });\n          }\n          if (rootOverSibling && dragDirection === 'down') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        }\n      });\n    }\n  };\n  var onDragEnd = function onDragEnd() {\n    var from = dragStartIndex,\n      to = dragEndIndex;\n    siblings.forEach(function (sibling) {\n      sibling.style.transform = '';\n    });\n    setSiblings([]);\n    setDragEndIndex(0);\n    setDragStartIndex(0);\n    setDragDirection(undefined);\n    setDragShift(0);\n    setDragging(false);\n    onDragFinish && onDragFinish({\n      from: from,\n      to: to\n    });\n  };\n  var useDraggableProps = {\n    onDragStart: onDragStart,\n    onDragMove: onDragMove,\n    onDragEnd: onDragEnd,\n    dragging: dragging\n  };\n  return useDraggableProps;\n};","map":{"version":3,"names":["React","useDraggable","_ref","rootElRef","onDragFinish","_React$useState","useState","_React$useState2","_slicedToArray","dragging","setDragging","_React$useState3","_React$useState4","siblings","setSiblings","_React$useState5","_React$useState6","dragStartIndex","setDragStartIndex","_React$useState7","_React$useState8","dragEndIndex","setDragEndIndex","_React$useState9","_React$useState10","dragShift","setDragShift","_React$useState11","undefined","_React$useState12","dragDirection","setDragDirection","onDragStart","_rootEl$parentElement","rootEl","current","_siblings","parentElement","childNodes","Array","from","children","idx","indexOf","onDragMove","e","originalEvent","preventDefault","style","transform","concat","shiftY","rootGesture","getBoundingClientRect","forEach","sibling","siblingIndex","siblingGesture","siblingHalfHeight","height","rootOverSibling","bottom","top","rootUnderSibling","onDragEnd","to","useDraggableProps"],"sources":["E:\\lessonReactForm\\mini-app\\node_modules\\@vkontakte\\vkui\\src\\components\\Cell\\useDraggable.tsx"],"sourcesContent":["import * as React from 'react';\nimport { TouchEvent } from '../Touch/Touch';\nimport { CellProps } from './Cell';\n\nexport interface DraggableProps {\n  onDragStart: () => void;\n  onDragEnd: () => void;\n  onDragMove: (e: TouchEvent) => void;\n}\n\ninterface UseDraggableProps extends DraggableProps {\n  dragging: boolean;\n}\n\nexport const useDraggable = <T extends HTMLElement>({\n  rootElRef,\n  onDragFinish,\n}: Pick<CellProps, 'onDragFinish'> & {\n  rootElRef: React.MutableRefObject<T | null>;\n}) => {\n  const [dragging, setDragging] = React.useState<boolean>(false);\n\n  const [siblings, setSiblings] = React.useState<HTMLElement[]>([]);\n  const [dragStartIndex, setDragStartIndex] = React.useState<number>(0);\n  const [dragEndIndex, setDragEndIndex] = React.useState<number>(0);\n  const [dragShift, setDragShift] = React.useState<number>(0);\n  const [dragDirection, setDragDirection] = React.useState<'down' | 'up' | undefined>(undefined);\n\n  const onDragStart = () => {\n    const rootEl = rootElRef.current;\n    if (!rootEl) {\n      return;\n    }\n\n    setDragging(true);\n\n    let _siblings: HTMLElement[] = [];\n    if (rootEl.parentElement?.childNodes) {\n      _siblings = Array.from(rootEl.parentElement.children) as HTMLElement[];\n    }\n    const idx = _siblings.indexOf(rootEl);\n\n    setDragStartIndex(idx);\n    setDragEndIndex(idx);\n    setSiblings(_siblings);\n    setDragShift(0);\n  };\n\n  const onDragMove = (e: TouchEvent) => {\n    e.originalEvent.preventDefault();\n\n    const rootEl = rootElRef.current;\n\n    if (rootEl) {\n      rootEl.style.transform = `translateY(${e.shiftY}px)`;\n      const rootGesture = rootEl.getBoundingClientRect();\n\n      setDragDirection(dragShift - e.shiftY < 0 ? 'down' : 'up');\n      setDragShift(e.shiftY);\n      setDragEndIndex(dragStartIndex);\n\n      siblings.forEach((sibling: HTMLElement, siblingIndex: number) => {\n        const siblingGesture = sibling.getBoundingClientRect();\n        const siblingHalfHeight = siblingGesture.height / 2;\n\n        const rootOverSibling = rootGesture.bottom > siblingGesture.top + siblingHalfHeight;\n        const rootUnderSibling = rootGesture.top < siblingGesture.bottom - siblingHalfHeight;\n\n        if (dragStartIndex < siblingIndex) {\n          if (rootOverSibling) {\n            if (dragDirection === 'down') {\n              sibling.style.transform = 'translateY(-100%)';\n            }\n\n            setDragEndIndex((dragEndIndex) => dragEndIndex + 1);\n          }\n          if (rootUnderSibling && dragDirection === 'up') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        } else if (dragStartIndex > siblingIndex) {\n          if (rootUnderSibling) {\n            if (dragDirection === 'up') {\n              sibling.style.transform = 'translateY(100%)';\n            }\n\n            setDragEndIndex((dragEndIndex) => dragEndIndex - 1);\n          }\n          if (rootOverSibling && dragDirection === 'down') {\n            sibling.style.transform = 'translateY(0)';\n          }\n        }\n      });\n    }\n  };\n\n  const onDragEnd = () => {\n    const [from, to] = [dragStartIndex, dragEndIndex];\n\n    siblings.forEach((sibling: HTMLElement) => {\n      sibling.style.transform = '';\n    });\n\n    setSiblings([]);\n    setDragEndIndex(0);\n    setDragStartIndex(0);\n    setDragDirection(undefined);\n    setDragShift(0);\n\n    setDragging(false);\n\n    onDragFinish && onDragFinish({ from, to });\n  };\n\n  const useDraggableProps: UseDraggableProps = {\n    onDragStart,\n    onDragMove,\n    onDragEnd,\n    dragging,\n  };\n\n  return useDraggableProps;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
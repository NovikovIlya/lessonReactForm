{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from 'react';\nimport vkBridge from '@vkontakte/vk-bridge';\nimport { useDOM } from '../lib/dom';\nimport { noop } from '@vkontakte/vkjs';\nimport { resolveAppearance } from '../helpers/appearance';\nimport { matchMediaListAddListener, matchMediaListRemoveListener } from '../lib/matchMedia';\nvar initialAppearance = null;\nvkBridge.send('VKWebAppGetConfig').then(function (data) {\n  initialAppearance = resolveAppearance(data);\n}).catch(console.error);\nfunction autoDetectAppearanceByBridge(setAppearance, onDetectAppearanceByBridge) {\n  function bridgeListener(e) {\n    var _e$detail = e.detail,\n      type = _e$detail.type,\n      data = _e$detail.data;\n    if (type !== 'VKWebAppUpdateConfig') {\n      return;\n    }\n    initialAppearance = resolveAppearance(data);\n    if (initialAppearance) {\n      onDetectAppearanceByBridge();\n      setAppearance(initialAppearance);\n    }\n  }\n  vkBridge.subscribe(bridgeListener);\n  return function () {\n    return vkBridge.unsubscribe(bridgeListener);\n  };\n}\nfunction autoDetectAppearance(window, setAppearance) {\n  var mediaQuery = window && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');\n  if (mediaQuery === undefined) {\n    return noop;\n  }\n  var check = function check(event) {\n    // eslint-disable-next-line no-restricted-properties\n    setAppearance(event.matches ? 'dark' : 'light');\n  };\n  check(mediaQuery);\n  matchMediaListAddListener(mediaQuery, check);\n  return function () {\n    return matchMediaListRemoveListener(mediaQuery, check);\n  };\n}\nexport var useAutoDetectAppearance = function useAutoDetectAppearance(appearanceProp, onDetectAppearanceByBridge) {\n  var _useDOM = useDOM(),\n    window = _useDOM.window;\n  var onceDetectAppearanceByBridge = React.useRef(function () {\n    onDetectAppearanceByBridge && onDetectAppearanceByBridge();\n    onceDetectAppearanceByBridge.current = noop;\n  });\n  var _React$useState = React.useState(function () {\n      if (appearanceProp) {\n        return appearanceProp;\n      }\n      if (initialAppearance) {\n        onceDetectAppearanceByBridge.current();\n        return initialAppearance;\n      }\n      var mediaQuery = window && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');\n\n      // eslint-disable-next-line no-restricted-properties\n      return mediaQuery !== null && mediaQuery !== void 0 && mediaQuery.matches ? 'dark' : 'light';\n    }),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    appearance = _React$useState2[0],\n    setAppearance = _React$useState2[1];\n  React.useEffect(function () {\n    if (appearanceProp) {\n      setAppearance(appearanceProp);\n      return noop;\n    }\n    if (vkBridge.isEmbedded()) {\n      return autoDetectAppearanceByBridge(setAppearance, onceDetectAppearanceByBridge.current);\n    }\n    return autoDetectAppearance(window, setAppearance);\n  }, [window, appearanceProp]);\n  return appearance;\n};","map":{"version":3,"names":["React","vkBridge","useDOM","noop","resolveAppearance","matchMediaListAddListener","matchMediaListRemoveListener","initialAppearance","send","then","data","catch","console","error","autoDetectAppearanceByBridge","setAppearance","onDetectAppearanceByBridge","bridgeListener","e","_e$detail","detail","type","subscribe","unsubscribe","autoDetectAppearance","window","mediaQuery","matchMedia","undefined","check","event","matches","useAutoDetectAppearance","appearanceProp","_useDOM","onceDetectAppearanceByBridge","useRef","current","_React$useState","useState","_React$useState2","_slicedToArray","appearance","useEffect","isEmbedded"],"sources":["E:\\lessonReactForm\\mini-app\\node_modules\\@vkontakte\\vkui\\src\\hooks\\useAutoDetectAppearance.tsx"],"sourcesContent":["import * as React from 'react';\nimport vkBridge, {\n  AnyReceiveMethodName,\n  AppearanceType,\n  VKBridgeEvent,\n} from '@vkontakte/vk-bridge';\nimport { useDOM } from '../lib/dom';\nimport { noop } from '@vkontakte/vkjs';\nimport { resolveAppearance, VKBridgeConfigData } from '../helpers/appearance';\nimport { matchMediaListAddListener, matchMediaListRemoveListener } from '../lib/matchMedia';\n\nlet initialAppearance: AppearanceType | null = null;\n\nvkBridge\n  .send('VKWebAppGetConfig')\n  .then((data) => {\n    initialAppearance = resolveAppearance(data);\n  })\n  .catch(console.error);\n\nfunction autoDetectAppearanceByBridge(\n  setAppearance: (value: AppearanceType) => void,\n  onDetectAppearanceByBridge: () => void,\n) {\n  function bridgeListener(e: VKBridgeEvent<AnyReceiveMethodName>) {\n    const { type, data } = e.detail;\n\n    if (type !== 'VKWebAppUpdateConfig') {\n      return;\n    }\n\n    initialAppearance = resolveAppearance(data as VKBridgeConfigData);\n\n    if (initialAppearance) {\n      onDetectAppearanceByBridge();\n      setAppearance(initialAppearance);\n    }\n  }\n\n  vkBridge.subscribe(bridgeListener);\n\n  return () => vkBridge.unsubscribe(bridgeListener);\n}\n\nfunction autoDetectAppearance(\n  window: Window | undefined,\n  setAppearance: (value: AppearanceType) => void,\n): () => void {\n  const mediaQuery =\n    window && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');\n\n  if (mediaQuery === undefined) {\n    return noop;\n  }\n\n  const check = (event: MediaQueryList | MediaQueryListEvent) => {\n    // eslint-disable-next-line no-restricted-properties\n    setAppearance(event.matches ? 'dark' : 'light');\n  };\n\n  check(mediaQuery);\n  matchMediaListAddListener(mediaQuery, check);\n\n  return () => matchMediaListRemoveListener(mediaQuery, check);\n}\n\nexport const useAutoDetectAppearance = (\n  appearanceProp?: AppearanceType,\n  onDetectAppearanceByBridge?: () => void,\n): AppearanceType => {\n  const { window } = useDOM();\n  const onceDetectAppearanceByBridge = React.useRef(() => {\n    onDetectAppearanceByBridge && onDetectAppearanceByBridge();\n    onceDetectAppearanceByBridge.current = noop;\n  });\n\n  const [appearance, setAppearance] = React.useState<AppearanceType>(() => {\n    if (appearanceProp) {\n      return appearanceProp;\n    }\n\n    if (initialAppearance) {\n      onceDetectAppearanceByBridge.current();\n      return initialAppearance;\n    }\n\n    const mediaQuery =\n      window && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');\n\n    // eslint-disable-next-line no-restricted-properties\n    return mediaQuery?.matches ? 'dark' : 'light';\n  });\n\n  React.useEffect(() => {\n    if (appearanceProp) {\n      setAppearance(appearanceProp);\n      return noop;\n    }\n\n    if (vkBridge.isEmbedded()) {\n      return autoDetectAppearanceByBridge(setAppearance, onceDetectAppearanceByBridge.current);\n    }\n\n    return autoDetectAppearance(window, setAppearance);\n  }, [window, appearanceProp]);\n\n  return appearance;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}